<DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Geolocation</title>
      <link
        rel="icon"
        type="image/png"
        sizes="32x32"
        href="/images/favicon-32x32.png"
      />
    </head>
    <body>
      <h1>Hello World!</h1>
      <p>Your coordinates are:</p>
      <p>Latitude: <span id="lat"></span>&deg;</p>
      <p>Longitude: <span id="lon"></span>&deg;</p>
      <label for="vegetable">What is your favorite vegetable</label>
      <input type="text" id="vegetable" />
      <button id="submit">Submit</button>
      <button id="getData">Get Data</button>
      <button id="eraseData">Erase</button>
      <script>
        let latitude, longitude, vegetable;
        const button = document.getElementById("submit");
        button.addEventListener("click", async (event) => {
          vegetable = document.getElementById("vegetable").value;
          const data = { latitude, longitude, vegetable };
          const options = {
            method: "POST",
            headers: {
              "Content-Type": "application/JSON",
            },
            body: JSON.stringify(data),
          };
          const response = await fetch("/api", options);
          const json = await response.json();
          console.log(json);
          document.getElementById("lat").textContent = latitude;
          document.getElementById("lon").textContent = longitude;
        });

        if ("geolocation" in navigator) {
          console.log("geolocation available");
          navigator.geolocation.getCurrentPosition(async (position) => {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
          });
        } else {
          console.log("geolocation not available");
        }
        document.getElementById("getData").addEventListener("click", getData);
        document
          .getElementById("eraseData")
          .addEventListener("click", eraseData);
        //why do they appear in such weird order?
        let root;
        async function eraseData() {
          console.log(root);
          document.querySelectorAll(".root").forEach((e) => e.remove());
        }
        async function getData() {
          const response = await fetch("/api");
          const data = await response.json();
          console.log(data);

          for (item of data) {
            root = document.createElement("div");
            root.classList.add("root");
            const vegetable = document.createElement("p");
            const date = document.createElement("p");
            const geo = document.createElement("p");

            vegetable.textContent = `vegetable: ${item.vegetable}`;
            geo.textContent = `${item.latitude}°, ${item.longitude}°`;
            const dateString = new Date(item.timestamp).toLocaleString();
            date.textContent = dateString;

            root.append(vegetable, date, geo);
            document.body.append(root);
          }
        }
      </script>
    </body>
  </html>
</DOCTYPE>
